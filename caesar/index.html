<html>
	<head>
		<title>Caesar</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="http://visjs.org/dist/vis.js"></script>
		<script src="md5.js"></script>
		

		<style>
			body{
				margin: 0px;
				padding: 0px;
				font-family: Helvetica, Arial
			}
			
			#content{
				width: 100%;
				height: 100%;
				float: left;
				display: block;
			}

			#network {
				width: 75%;
				height: 100%;
				background-color:#333333;
				margin: 0px;
				padding: 0px;
				float: left;
				display: block;
		    }
		    
		    #info {
	    	    width: 25%;
		    	margin: 0px;
		    	padding: 20px;
	    	    box-sizing: border-box;
		    	float: left;
		    	display: block;
		    	height: 100%;
		    	overflow: scroll
		    }
		    #info ul{
		    	margin: 0px;
		    	padding: 0px;
		    }
			#info ul li{
				padding: 8px;
				list-style-type: none;
				border: 1px solid #ccc;
				border-bottom: 0px;
			}
			#info ul li:first-child{
				border-radius: 10px 10px 0px 0px;
			}
			#info ul li:last-child{
				border-radius: 0px 0px 10px 10px;
			    border-bottom: 1px solid #ccc !important;
			}
			#info .badge{
				background: rgb(255,165,0);
				color: white;
				padding: 2px;
				padding-right: 5px;
				padding-left: 5px;
				font-size: 12px;
				margin-right: 5px;
				margin-left: 5px;
				border-radius: 30%;
				float: right;
			}

		    #loadingBar {
	            position:absolute;
	            top:0px;
	            left:0px;
	            width: 75%;
				height: 100%;
	            background-color:rgba(200,200,200,0.8);
	            -webkit-transition: all 0.5s ease;
	            -moz-transition: all 0.5s ease;
	            -ms-transition: all 0.5s ease;
	            -o-transition: all 0.5s ease;
	            transition: all 0.5s ease;
	            opacity:1;
	        }
	        #text {
	            position:absolute;
	            top:8px;
	            left:530px;
	            width:30px;
	            height:50px;
	            margin:auto auto auto auto;
	            font-size:22px;
	            color: #000000;
	        }


	        div.outerBorder {
	            position:relative;
	            top:400px;
	            width:600px;
	            height:44px;
	            margin:auto auto auto auto;
	            border:8px solid rgba(0,0,0,0.1);
	            background: rgb(252,252,252); /* Old browsers */
	            background: -moz-linear-gradient(top,  rgba(252,252,252,1) 0%, rgba(237,237,237,1) 100%); /* FF3.6+ */
	            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(252,252,252,1)), color-stop(100%,rgba(237,237,237,1))); /* Chrome,Safari4+ */
	            background: -webkit-linear-gradient(top,  rgba(252,252,252,1) 0%,rgba(237,237,237,1) 100%); /* Chrome10+,Safari5.1+ */
	            background: -o-linear-gradient(top,  rgba(252,252,252,1) 0%,rgba(237,237,237,1) 100%); /* Opera 11.10+ */
	            background: -ms-linear-gradient(top,  rgba(252,252,252,1) 0%,rgba(237,237,237,1) 100%); /* IE10+ */
	            background: linear-gradient(to bottom,  rgba(252,252,252,1) 0%,rgba(237,237,237,1) 100%); /* W3C */
	            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fcfcfc', endColorstr='#ededed',GradientType=0 ); /* IE6-9 */
	            border-radius:72px;
	            box-shadow: 0px 0px 10px rgba(0,0,0,0.2);
	        }

	        #border {
	            position:absolute;
	            top:10px;
	            left:10px;
	            width:500px;
	            height:23px;
	            margin:auto auto auto auto;
	            box-shadow: 0px 0px 4px rgba(0,0,0,0.2);
	            border-radius:10px;
	        }

	        #bar {
	            position:absolute;
	            top:0px;
	            left:0px;
	            width:20px;
	            height:20px;
	            margin:auto auto auto auto;
	            border-radius:11px;
	            border:2px solid rgba(30,30,30,0.05);
	            background: rgb(0, 173, 246); /* Old browsers */
	            box-shadow: 2px 0px 4px rgba(0,0,0,0.4);
	        }
	        .node-link{
	        	
	        }
	        .node-link:hover{
	        	/*text-decoration: underline;*/
	        	cursor: pointer;
	        }
	        #node-img{
	        	width: 100%;
	        	display: block;
	        	box-sizing: border-box;
				text-align: center;
	        }
	        #node-img img{
	        	border-radius: 50%;
	        	width: 50%;
	        	margin: 0 auto;
	        	border: 3px solid #333;
	        }
	        h3 span{
	        	padding: 3px;
	        	padding-right: 5px;
	        	padding-left: 5px;
	        	border-radius: 5px;
	        }
		</style>
	</head>
	
<body>
	
	<div class="content">
		<div id="network"></div>
		<div id="loadingBar">
        <div class="outerBorder">
            <div id="text">0%</div>
            <div id="border">
                <div id="bar"></div>
            </div>
        </div>
    </div>
		<div id="info">
			<div id="node-img"></div>
			<h1 id="node-title">Hi there!</h1>
			<div id="node-loc"></div>
			<div id="node-bid"></div>
			<div id="node-loc"></div>
			<div id="node-content">
				<p>Click on of the nodes to get started!</p>
			</div>
		</div>
	</div>
	
<script>
	$(document).ready(function() {
	    nodes = [];
	    edges = [];

		$(document).on('click', '.node-link', function() { 
			node_id = $(this).attr('id'); 
			network.selectNodes([node_id])
			var clicked_node = network.nodesHandler.body.nodes[node_id];
		    nodeShow(clicked_node);
		});

	    function nodeExists(nodes, id) {
		  return nodes.some(function(element) {
		    return element.id === id;
		  }); 
		}

		function nodeFind(nodes, name) {
		  return nodes.some(function(element) {
		    if (element.name === name){
		    	return element.id
		  	}
		  }); 
		}

		function toList(nodes){
			html = '<ul>'
			for (var i = nodes.length - 1; i >= 0; i--) {
				html += '<li class="node-link" id="' +  nodes[i].id + '">'
				html += nodes[i].name
				html += ' <span class="badge">' + network.getConnectedNodes(nodes[i].id).length +'</span>';
				html += '</li>'
			}
			html += '</ul>'
			return html
		}

		function nodeRelated(node, type) {

			var connectedNodes = network.getConnectedNodes(node.id);

			related = []

			for (var i = connectedNodes.length - 1; i >= 0; i--) {
				connected_node_id = connectedNodes[i]
				connected_node = network.nodesHandler.body.nodes[connected_node_id]
				
				if (connected_node.options.type == type) {
					related.push(connected_node.options)
				}
			}

			return toList(related)
		}


		function nodeShow(node){
			$('#node-content').empty()
			$('#node-img').empty()
			$('#node-loc').empty()

			if (node.options.type == "person"){
				$('#node-title').html(node.options.name)
					content = ''

					if (node.options.first_bid){
						$('#node-bid').html('<p>Was nog niet eerder op een BID-diner')
					} else {
						$('#node-bid').html('<p>Was al eerder op een BID-diner')
					}

					if (node.options.loc){
						$('#node-bid').html('Locatie: <i>' + node.options.loc + '</i>')
					}						

					if (node.options.connections){
						content += '<h3>Connections</h3>' + nodeRelated(node, 'person')
					}	
				
					if (node.options.orgs){
						content += '<h3>Organisations <span style="background-color: #3e93ae">&#9679;</span></h3></h3>' + nodeRelated(node, 'org')
					}
					if (node.options.education) {						
						content += '<h3>Education <span style="background-color: #3eee93">&#9679;</span></h3>' + nodeRelated(node, 'edu')
					}
					if (node.options.skills) {
						content += '<h3>Skills <span style="background-color: #cccccc">&#9679;</span></h3>' + nodeRelated(node, 'skill')
					}
				
				$('#node-img').html('<img class="person-image" src="' + node.options.image + '">')
				$('#node-content').html(content) 

			} else if (node.options.type == "skill") {
				$('#node-title').html('Skill: ' + node.options.name)
				content = nodeRelated(node, 'person')				
				$('#node-content').html(content)
				
			} else if (node.options.type == "org") {
				$('#node-title').html('Organisatie: ' + node.options.name)
				content = nodeRelated(node, 'person')				
				$('#node-content').html(content)
				
			} else if (node.options.type == "edu") {
				$('#node-title').html('Educatie: ' + node.options.name)
				content = nodeRelated(node, 'person')				
				$('#node-content').html(content)
				
			} else if (node.options.type == "loc") {
				$('#node-title').html('Locatie: ' + node.options.name)
				content = nodeRelated(node, 'person')				
				$('#node-content').html(content)
			}
		}



		$.getJSON( "data.json", function( data ) {
		  
		  	$.each( data, function(i, person ) {

		  		person_id = md5(person['name'])

		  		if (person['first_bid']){
		  			first_bid = true;
		  		} else {
		  			first_bid = false;
		  		}

		  		nodes.push({
		  			'id': person_id, 
		  			'type': 'person',
		  			'shape': 'circularImage', 
		  			'image': person['img'], 
		  			'loc': person['loc'], 
		  			'name': person['name'], 
		  			'first_bid': first_bid,
		  			// 'value': 800, 
		  			'color': '#222222',
		  			'skills': person['skills'],
		  			'education': person['education'],
		  			'orgs': person['orgs'],
		  			'size': 60,
		  			'connections': person['connections'],
		  		})

	  			$.each( person['skills'], function(j, skill){
	  				skill_id = md5(skill);
	  				if (nodeExists(nodes, skill_id)){
	  					edges.push({'from': person_id, 'to': skill_id, color:{color:'rgba(200,200,200,0.7)', highlight:'rgb(255,165,0)'}})	
	  				} else {
	  					nodes.push({'name': skill , 'id': skill_id, color: "#cccccc", 'value': 10, 'type': 'skill'})
	  					edges.push({'from': person_id, 'to': skill_id, color:{color:'rgba(200,200,200,0.7)', highlight:'rgb(255,165,0)'}})	
	  				}
	  			})

	  			if (person['loc']){
	  				loc_id = md5(person['loc']);
	  				if (nodeExists(nodes, loc_id)){
	  					edges.push({'type': 'loc', 'from': person_id, 'to': loc_id, color:{color:'rgba(200,200,200,1)', highlight:'#5F5AA2'}})	
	  				} else {
	  					nodes.push({'name': person['loc'], 'id': loc_id, 'type': 'loc', color: 'rgb(200,10,0)'})
	  					edges.push({'type': 'loc', 'from': person_id, 'to': loc_id, color:{color:'rgba(200,200,200,1)', highlight:'#5F5AA2'}})	
	  				}
	  			}

	  			$.each( person['education'], function(j, edu){
	  				edu_id = md5(edu);
	  				if (nodeExists(nodes, edu_id)){
	  					edges.push({'type': 'edu', 'from': person_id, 'to': edu_id, color:{color:'rgba(200,200,200,1)', highlight:'#5F5AA2'}})	
	  				} else {
	  					nodes.push({'name': edu , 'id': edu_id, color: "#3eee93", 'value': 10, 'type': 'edu'})
	  					edges.push({'from': person_id, 'to': edu_id, color:{color:'rgba(200,200,200,1)', highlight:'rgb(255,165,0)'}})	
	  				}
	  			})

	  			$.each( person['orgs'], function(j, org){
	  				org_id = md5(org);
	  				if (nodeExists(nodes, org_id)){
	  					edges.push({'from': person_id, 'to': org_id, color:{color:'rgba(200,200,200,1)', highlight:'rgb(255,165,0)'}})	
	  				} else {
	  					nodes.push({ 'name': org , 'id': org_id, 'color': "#3e93ae", 'value': 10, 'type': 'org',})
	  					edges.push({'from': person_id, 'to': org_id, color:{color:'rgba(200,200,200,1)', highlight:'rgb(255,165,0)'}})	
	  				}
	  			})

	  			$.each( person['connections'], function(j, connection){
	  				connection_id = md5(connection);
	  				if (nodeExists(nodes, connection_id)){
	  					edges.push({'from': person_id, 'to': connection_id, color:{color:'rgba(200,200,200,1)', highlight:'rgb(255,165,0)'}})	
	  				}
	  			})
		  	});

			var container = document.getElementById('network');
			
			var data = {
				nodes: nodes,
				edges: edges
			};

			var options = {
                nodes: {
		          	borderWidth: 2,
		          	// color: {
		           //  	// border: '#222222',
		           //  	background: '#666666'
		          	// },
		          	font:{color:'#eeeeee'}

		        },
		        edges: {
	          		smooth:{
	          			enabled: false
	          		},
	          		// color: "#cccccc",
	          		selectionWidth: function (width) {return width*5;}
		        },
                layout: {
                    randomSeed: undefined,
                    improvedLayout:true,
                },
                physics: {
                    forceAtlas2Based: {
                        gravitationalConstant: -26,
                        centralGravity: 0.005,
                        springLength: 230,
                        springConstant: 0.18
                    },
                    maxVelocity: 146,
                    solver: 'forceAtlas2Based',
                    timestep: 0.35,
                    stabilization: {
                        enabled:true,
                        iterations:500,
                        updateInterval:25
                    }
                }
            };

			network = new vis.Network(container, data, options);

			network.on("selectNode", function (params) {
        		
        		var node_id = params.nodes[0];
			    var clicked_node = network.nodesHandler.body.nodes[node_id];
			    nodeShow(clicked_node);

  			});

  			network.on("stabilizationProgress", function(params) {
                var maxWidth = 496;
                var minWidth = 20;
                var widthFactor = params.iterations/params.total;
                var width = Math.max(minWidth,maxWidth * widthFactor);

                document.getElementById('bar').style.width = width + 'px';
                document.getElementById('text').innerHTML = Math.round(widthFactor*100) + '%';
            });
            network.once("stabilizationIterationsDone", function() {
                document.getElementById('text').innerHTML = '100%';
                document.getElementById('bar').style.width = '496px';
                document.getElementById('loadingBar').style.opacity = 0;
                // really clean the dom element
                setTimeout(function () {document.getElementById('loadingBar').style.display = 'none';}, 500);
            });

		 
		});


	});
</script>
</body>
</html>