<html>
	<head>
		<title>Caesar</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="http://visjs.org/dist/vis.js"></script>
		<script src="md5.js"></script>
		

		<style>
			body{
				margin: 0px;
				padding: 0px;
				font-family: Helvetica, Arial
			}
			
			#content{
				width: 100%;
				height: 100%;
				float: left;
				display: block;
			}

			#network {
				width: 75%;
				height: 100%;
				/*border: 1px solid lightgray;*/
				background-color:#333333;
				margin: 0px;
				padding: 0px;
				float: left;
				display: block;
		    }
		    
		    #info {
	    	    width: 25%;
		    	margin: 0px;
		    	padding: 20px;
	    	    box-sizing: border-box;

		    	float: left;
		    	display: block;
		    	height: 100%;
		    	overflow: scroll
		    }
		</style>
	</head>
	
<body>
	
	<div class="content">
		<div id="network"></div>
		<div id="info">
			<h1 id="node-title"></h1>
			<div id="node-content"></div>
		</div>
	</div>
	
<script>
	$(document).ready(function() {
	    nodes = [];
	    edges = [];

	    function nodeExists(nodes, id) {
		  return nodes.some(function(element) {
		    return element.id === id;
		  }); 
		}

		function toList(l){
			html = '<ul>'
			for (var i = l.length - 1; i >= 0; i--) {
				html += '<li>' + l[i]  + '</li>'
			}
			html += '</ul>'
			return html
		}


		function nodeRelated(node) {

			var connectedNodes = network.getConnectedNodes(node.id);

			names = []

			for (var i = connectedNodes.length - 1; i >= 0; i--) {
				connected_node_id = connectedNodes[i]
				connected_node = network.nodesHandler.body.nodes[connected_node_id]
				names.push(connected_node.options.name)
			}

			return toList(names)
		}



		function nodeShow(node){
			$('#node-content').empty()

			if (node.options.type == "person"){
				$('#node-title').html(node.options.name)
					content = ''
				
					if (node.options.orgs){
						content += '<h3>Organisations</h3>' + toList(node.options.orgs)
					}
					if (node.options.education) {						
						content += '<h3>Education</h3>' + toList(node.options.education)
					}
					if (node.options.skills) {
						content += '<h3>Skills</h3>' + toList(node.options.skills)
					}
				
				$('#node-content').html(content) 

			} else if (node.options.type == "skill") {
				$('#node-title').html('Skill: ' + node.options.skill)
				content = nodeRelated(node)				
				$('#node-content').html(content)
				
			} else if (node.options.type == "org") {
				$('#node-title').html('Organisatie: ' + node.options.org)
				content = nodeRelated(node)				
				$('#node-content').html(content)
				
			} else if (node.options.type == "edu") {
				$('#node-title').html('Educatie: ' + node.options.edu)
				content = nodeRelated(node)				
				$('#node-content').html(content)
				
			} 
		}

		$.getJSON( "data.json", function( data ) {
		  
		  	$.each( data, function(i, person ) {

		  		person_id = md5(person['name'])

		  		nodes.push({
		  			'id': person_id, 
		  			'type': 'person',
		  			'shape': 'circularImage', 
		  			'image': person['img'], 
		  			'name': person['name'], 
		  			// 'value': 800, 
		  			'color': '#222222',
		  			'skills': person['skills'],
		  			'education': person['education'],
		  			'orgs': person['orgs'],
		  			'size': 60,
		  		})

	  			$.each( person['skills'], function(j, skill){
	  				skill_id = md5(skill);
	  				if (nodeExists(nodes, skill_id)){
	  					edges.push({'from': person_id, 'to': skill_id, color:{color:'rgba(200,200,200,0.7)', highlight:'#355691'}})	
	  				} else {
	  					nodes.push({'skill': skill , 'id': skill_id, color: "#cccccc", 'value': 10, 'type': 'skill'})
	  					edges.push({'from': person_id, 'to': skill_id, color:{color:'rgba(200,200,200,0.7)', highlight:'#355691'}})	
	  				}
	  			})

	  			$.each( person['education'], function(j, edu){
	  				edu_id = md5(edu);
	  				if (nodeExists(nodes, edu_id)){
	  					edges.push({'from': person_id, 'to': edu_id, color:{color:'rgba(200,200,200,1)', highlight:'#5F5AA2'}})	
	  				} else {
	  					nodes.push({'edu': edu , 'id': edu_id, color: "#aaaaaa", 'value': 10, 'type': 'edu'})
	  					edges.push({'from': person_id, 'to': edu_id, color:{color:'rgba(200,200,200,1)', highlight:'#5F5AA2'}})	
	  				}
	  			})

	  			$.each( person['orgs'], function(j, org){
	  				org_id = md5(org);
	  				if (nodeExists(nodes, org_id)){
	  					edges.push({'from': person_id, 'to': org_id, color:{color:'rgba(200,200,200,1)', highlight:'#413F54'}})	
	  				} else {
	  					nodes.push({'org': org , 'id': org_id, 'color': "#3e93ae", 'value': 10, 'type': 'org',})
	  					edges.push({'from': person_id, 'to': org_id, color:{color:'rgba(200,200,200,1)', highlight:'#413F54'}})	
	  				}
	  			})
		  	});

			var container = document.getElementById('network');
			
			var data = {
				nodes: nodes,
				edges: edges
			};

			var options = {
                nodes: {
		          	borderWidth: 2,
		          	// color: {
		           //  	// border: '#222222',
		           //  	background: '#666666'
		          	// },
		          	font:{color:'#eeeeee'}

		        },
		        edges: {
	          		smooth:{
	          			enabled: false
	          		},
	          		// color: "#cccccc",
	          		selectionWidth: function (width) {return width*5;}
		        },
                layout: {
                    randomSeed: undefined,
                    improvedLayout:true,
                },
                physics: {
                    forceAtlas2Based: {
				      gravitationalConstant: -50,
				      centralGravity: 0.01,
				      springConstant: 0.08,
				      springLength: 100,
				      damping: 0.4,
				      avoidOverlap: 1
				    },
                    maxVelocity: 50,
                    solver: 'forceAtlas2Based',
                    timestep: 0.01,
                    stabilization: {iterations: 0}
                },  
            };

			network = new vis.Network(container, data, options);

			network.on("selectNode", function (params) {
        		
        		var node_id = params.nodes[0];
			    var clicked_node = network.nodesHandler.body.nodes[node_id];

			    nodeShow(clicked_node);

  			});
		 
		});


	});
</script>
</body>
</html>